# 表格自定义规则

## 1. 格式规则语法
格式规则使用分号分隔多个规则，每个规则格式为：
```
规则类型:参数1,参数2,...
```

## 2. 支持的规则类型

### 2.1 字体样式
```
font:字体名称,字体大小,起始行-结束行,起始列-结束列
```

### 2.2 加粗
```
bold:起始行-结束行,起始列-结束列
```

### 2.3 背景颜色
```
bg_color:颜色代码,起始行-结束行,起始列-结束列
```

### 2.4 字体颜色
```
font_color:颜色代码,起始行-结束行,起始列-结束列
```

### 2.5 边框
```
border:起始行-结束行,起始列-结束列
```

### 2.6 数据条
```
data_bar:起始行-结束行,起始列-结束列
```

### 2.7 色阶
```
color_scale:起始行-结束行,起始列-结束列
```

### 2.8 对齐
```
alignment:对齐方式,起始行-结束行,起始列-结束列
```
对齐方式：left/center/right

### 2.9 数字格式
```
number_format:格式类型,小数位数,起始行-结束行,起始列-结束列
```
格式类型：general/number/percentage

## 3. 示例
```
font:微软雅黑,12,1-10,1-5;
bg_color:#FF0000,1-1,1-5;
border:1-10,1-5;
alignment:center,1-10,1-5;
number_format:number,2,1-10,1-5
```

# 文件名格式化功能说明

## 概述

文件名格式化功能允许用户在定义报表文件名时使用各种占位符和函数，使文件名能够动态地包含日期、时间等信息。当系统生成报表时，这些占位符和函数会被替换为实际的值。

## 格式化规则

### 1. 日期时间占位符

您可以在文件名中使用标准的日期时间格式占位符，它们会被替换为当前日期和时间的相应部分。

| 占位符 | 描述 | 示例 |
|--------|------|------|
| `%Y` | 四位数年份 | 2025 |
| `%y` | 两位数年份 | 25 |
| `%m` | 两位数月份 | 02 |
| `%d` | 两位数日期 | 28 |
| `%H` | 小时 (00-23) | 15 |
| `%I` | 小时 (01-12) | 03 |
| `%M` | 分钟 | 45 |
| `%S` | 秒 | 30 |
| `%p` | AM 或 PM | PM |
| `%a` | 星期几的简写 | Wed |
| `%A` | 星期几的全称 | Wednesday |
| `%b` | 月份的简写 | Feb |
| `%B` | 月份的全称 | February |
| `%j` | 一年中的第几天 | 059 |
| `%W` | 一周的星期几（周一为第一天） | 3 |
| `%w` | 星期几 (0-6, 0是星期天) | 3 |
| `%z` | UTC时区偏移 | +0800 |
| `%Z` | 时区名称 | CST |

**示例：**
- 文件名模板：`报表_%Y年%m月%d日_%H时%M分.xlsx`
- 生成结果：`报表_2025年02月28日_15时45分.xlsx`

### 2. 日期计算函数

您可以使用 `date_add` 函数来计算相对于当前日期的未来或过去日期。

**语法：**
```
{date_add(天数, "格式")}
```

- `天数`：正数表示未来日期，负数表示过去日期
- `格式`：使用与日期时间占位符相同的格式字符串

**示例：**
- 文件名模板：`{date_add(1, "%Y-%m-%d")}报表.xlsx`
- 生成结果：`2025-03-01报表.xlsx`（假设当前日期是2025-02-28）

- 文件名模板：`{date_add(-7, "%Y年%m月%d日")}至今报表.xlsx`
- 生成结果：`2025年02月21日至今报表.xlsx`（假设当前日期是2025-02-28）

### 3. 组合使用

您可以在同一个文件名中组合使用多种格式化规则。

**示例：**
- 文件名模板：`{date_add(-1, "%Y%m%d")}_到_{%Y%m%d}_销售报表.xlsx`
- 生成结果：`20250227_到_20250228_销售报表.xlsx`（假设当前日期是2025-02-28）

## 文件名重复处理

当生成的文件名在输出目录中已存在时，系统会自动在文件名后添加序号，以避免覆盖已有文件。

**示例：**
- 原始生成文件名：`销售报表.xlsx`
- 如果该文件已存在，新生成的文件名将是：`销售报表(1).xlsx`
- 如果 `销售报表(1).xlsx` 也已存在，则新生成的文件名将是：`销售报表(2).xlsx`，以此类推

## 使用场景

### 定时报表

对于定时生成的报表，系统会检查任务的 `output_filename` 属性或使用任务名作为文件名模板。如果文件名模板中包含格式化占位符或函数，系统会应用上述规则进行格式化；如果没有，则使用原有的命名规则（任务名+时间戳）。

### 手动报表

对于手动生成的报表，系统会保持原有的命名规则，不应用格式化功能。

## 注意事项

1. 格式化占位符区分大小写，请确保使用正确的大小写
2. 在使用 `date_add` 函数时，格式字符串必须用引号（单引号或双引号）包围
3. 如果文件名中没有任何格式化占位符或函数，系统将使用原有的命名规则
4. 文件名中不支持的字符（如 `/`, `\`, `:`, `*`, `?`, `"`, `<`, `>`, `|`）可能会被系统自动替换或移除

## 示例表格

| 文件名模板 | 生成结果（假设当前日期是2025-02-28） |
|------------|--------------------------------------|
| `销售报表_%Y%m%d.xlsx` | `销售报表_20250228.xlsx` |
| `{date_add(1, "%Y-%m-%d")}销售预测.xlsx` | `2025-03-01销售预测.xlsx` |
| `{%Y}年{%m}月销售报表.xlsx` | `2025年02月销售报表.xlsx` |
| `{date_add(-7, "%Y%m%d")}_至_{%Y%m%d}_周报.xlsx` | `20250221_至_20250228_周报.xlsx` |
| `{Q1}季度报表.xlsx` | `Q1季度报表.xlsx` |
